import{ao as C,ap as k,_ as S,a as j,r as d,c as U,b as t,w as a,o as A,e as h,d as T}from"./index-858ac1df.js";import{m as E}from"./message-dfea8e68.js";var g={exports:{}};(function(_,s){(function(u,v){v()})(C,function(){function u(e,o){return typeof o>"u"?o={autoBom:!1}:typeof o!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e}function v(e,o,c){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){b(n.response,o,c)},n.onerror=function(){console.error("could not download file")},n.send()}function l(e){var o=new XMLHttpRequest;o.open("HEAD",e,!1);try{o.send()}catch{}return 200<=o.status&&299>=o.status}function m(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(o)}}var f=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof C=="object"&&C.global===C?C:void 0,w=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),b=f.saveAs||(typeof window!="object"||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!w?function(e,o,c){var n=f.URL||f.webkitURL,r=document.createElement("a");o=o||e.name||"download",r.download=o,r.rel="noopener",typeof e=="string"?(r.href=e,r.origin===location.origin?m(r):l(r.href)?v(e,o,c):m(r,r.target="_blank")):(r.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(r.href)},4e4),setTimeout(function(){m(r)},0))}:"msSaveOrOpenBlob"in navigator?function(e,o,c){if(o=o||e.name||"download",typeof e!="string")navigator.msSaveOrOpenBlob(u(e,c),o);else if(l(e))v(e,o,c);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){m(n)})}}:function(e,o,c,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),typeof e=="string")return v(e,o,c);var r=e.type==="application/octet-stream",x=/constructor/i.test(f.HTMLElement)||f.safari,V=/CriOS\/[\d]+/.test(navigator.userAgent);if((V||r&&x||w)&&typeof FileReader<"u"){var y=new FileReader;y.onloadend=function(){var i=y.result;i=V?i:i.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=i:location=i,n=null},y.readAsDataURL(e)}else{var p=f.URL||f.webkitURL,D=p.createObjectURL(e);n?n.location=D:location.href=D,n=null,setTimeout(function(){p.revokeObjectURL(D)},4e4)}});f.saveAs=b.saveAs=b,_.exports=b})})(g);var L=g.exports;const R=k(L);const F={data(){return{formData:{canteen:null,floor:null,window:null,StartTime:null,EndTime:null},trafficData:[],deleteConfirmationVisible:!1}},methods:{async submitForm(){const _=await j({method:"get",url:`test/api/home_page/traffic_monitoring/download?canteen=${this.formData.canteen}&floor=${this.formData.floor}&window=${this.formData.window}&StartTime=${this.formData.StartTime}&EndTime=${this.formData.EndTime}`,headers:{"User-Agent":"Apifox/1.0.0 (https://apifox.com)"}});_.data.code==200?(E("查询成功",{type:"success"}),this.trafficData.push(_.data.data)):E("查询失败",{type:"error"})},showDeleteConfirmation(){this.deleteConfirmationVisible=!0},cancelDelete(){this.deleteConfirmationVisible=!1},deleteHistory(){this.trafficData=[],this.cancelDelete()},downloadCSV(){let _=`食堂编号,楼层号,窗口号,人流量,开始时间,结束时间
`;this.trafficData.forEach(u=>{_+=`${u.canteen},${u.floor},${u.window},${u.humanTraffic},${u.time.startTime},${u.time.endTime}
`});const s=new Blob([_],{type:"text/csv;charset=utf-8;"});R.saveAs(s,"trafficData.csv")}}},B={class:"table-container"},M=T("div",{class:"card-header"},[T("span",null,"流量数据查询")],-1),O={class:"button-container"},H={class:"dialog-footer",style:{display:"flex, justify-content: center,margin-top: 50px, margin-bottom:5px"}};function N(_,s,u,v,l,m){const f=d("el-tag"),w=d("el-option"),b=d("el-select"),e=d("el-form-item"),o=d("el-input"),c=d("el-date-picker"),n=d("el-button"),r=d("el-form"),x=d("el-card"),V=d("el-space"),y=d("el-dialog"),p=d("el-table-column"),D=d("el-table");return A(),U("div",B,[t(V,{direction:"vertical",size:"large"},{default:a(()=>[t(f,{style:{width:"77vw",justifyContent:"center"},size:"large"},{default:a(()=>[h(" 在此处选择食堂编号、楼层和窗口号并获取窗口的历史流量统计 ")]),_:1}),t(x,{shadow:"never",style:{width:"77vw",justifyContent:"center"}},{header:a(()=>[M]),default:a(()=>[t(r,{model:l.formData,"label-width":"120px"},{default:a(()=>[t(e,{label:"食堂编号",style:{width:"40%"}},{default:a(()=>[t(b,{modelValue:l.formData.canteen,"onUpdate:modelValue":s[0]||(s[0]=i=>l.formData.canteen=i),placeholder:"请选择"},{default:a(()=>[t(w,{label:"北食堂",value:"1"}),t(w,{label:"清真食堂",value:"2"}),t(w,{label:"南食堂",value:"3"}),t(w,{label:"东食堂",value:"4"})]),_:1},8,["modelValue"])]),_:1}),t(e,{label:"楼层号",style:{width:"20%"}},{default:a(()=>[t(o,{modelValue:l.formData.floor,"onUpdate:modelValue":s[1]||(s[1]=i=>l.formData.floor=i),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),t(e,{label:"窗口号",style:{width:"20%"}},{default:a(()=>[t(o,{modelValue:l.formData.window,"onUpdate:modelValue":s[2]||(s[2]=i=>l.formData.window=i),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),t(e,{label:"开始时间"},{default:a(()=>[t(c,{modelValue:l.formData.StartTime,"onUpdate:modelValue":s[3]||(s[3]=i=>l.formData.StartTime=i),type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue"])]),_:1}),t(e,{label:"结束时间"},{default:a(()=>[t(c,{modelValue:l.formData.EndTime,"onUpdate:modelValue":s[4]||(s[4]=i=>l.formData.EndTime=i),type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue"])]),_:1}),t(e,{class:"button-row"},{default:a(()=>[T("div",O,[t(n,{type:"primary",onClick:m.submitForm},{default:a(()=>[h("查询流量数据")]),_:1},8,["onClick"]),t(n,{type:"danger",onClick:m.showDeleteConfirmation},{default:a(()=>[h("删除查询记录")]),_:1},8,["onClick"]),t(n,{type:"success",onClick:m.downloadCSV},{default:a(()=>[h("下载CSV文件")]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),t(y,{title:"确认删除",modelValue:l.deleteConfirmationVisible,"onUpdate:modelValue":s[5]||(s[5]=i=>l.deleteConfirmationVisible=i),width:"30%",onClose:m.cancelDelete},{default:a(()=>[t(r,null,{default:a(()=>[t(e,{label:"确认要删除记录吗？"})]),_:1}),T("div",H,[t(n,{onClick:m.deleteHistory,type:"danger"},{default:a(()=>[h("确认删除")]),_:1},8,["onClick"]),t(n,{onClick:m.cancelDelete},{default:a(()=>[h("取消")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","onClose"]),t(D,{data:l.trafficData,style:{width:"77vw"}},{default:a(()=>[t(p,{prop:"canteen",label:"食堂编号"}),t(p,{prop:"floor",label:"楼层号"}),t(p,{prop:"window",label:"窗口号"}),t(p,{prop:"humanTraffic",label:"人流量"}),t(p,{prop:"time.startTime",label:"开始时间"}),t(p,{prop:"time.endTime",label:"结束时间"})]),_:1},8,["data"])])}const G=S(F,[["render",N]]);export{G as default};
